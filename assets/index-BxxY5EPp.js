import{t as me,c as ue,r as c,j as e,a as O,S as xe,b as V,C as he,d as X,P as pe,e as _,I as W,f as G,g as q,h as J,R as K,i as ge,L as Z,k as Q,l as fe,T as be,M as je,m as Y,n as ye,o as z,s as ve,u as Ne,U as we,p as R,F as ke,D as Ce,q as Se,v as Pe,w as ee,x as De,y as Re,z as ze,H as S,A as Me,B as Fe,E as Ae,Z as Ie,G as Te,J as Ee,K as $e,N as Be,O as B,Q as He,V as Ue}from"./vendor-CH_QdvXx.js";import"./plotly-TSe5MiLa.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=a(t);fetch(t.href,r)}})();const Le="modulepreload",Oe=function(s){return"/xrd-analyzer/"+s},H={},Ve=function(n,a,o){let t=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));t=Promise.allSettled(a.map(d=>{if(d=Oe(d),d in H)return;H[d]=!0;const u=d.endsWith(".css"),x=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${x}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":Le,u||(p.as="script"),p.crossOrigin="",p.href=d,i&&p.setAttribute("nonce",i),document.head.appendChild(p),u)return new Promise((y,h)=>{p.addEventListener("load",y),p.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return t.then(l=>{for(const i of l||[])i.status==="rejected"&&r(i.reason);return n().catch(r)})};function g(...s){return me(ue(s))}const C=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("rounded-xl border bg-card text-card-foreground shadow",s),...n}));C.displayName="Card";const se=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("flex flex-col space-y-1.5 p-6",s),...n}));se.displayName="CardHeader";const te=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("font-semibold leading-none tracking-tight",s),...n}));te.displayName="CardTitle";const Xe=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("text-sm text-muted-foreground",s),...n}));Xe.displayName="CardDescription";const ae=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("p-6 pt-0",s),...n}));ae.displayName="CardContent";const _e=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("flex items-center p-6 pt-0",s),...n}));_e.displayName="CardFooter";const We=O("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),k=c.forwardRef(({className:s,variant:n,size:a,asChild:o=!1,...t},r)=>{const l=o?xe:"button";return e.jsx(l,{className:g(We({variant:n,size:a,className:s})),ref:r,...t})});k.displayName="Button";const Ge=fe,qe=be,Je=c.forwardRef(({className:s,inset:n,children:a,...o},t)=>e.jsxs(V,{ref:t,className:g("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",s),...o,children:[a,e.jsx(he,{className:"ml-auto"})]}));Je.displayName=V.displayName;const Ke=c.forwardRef(({className:s,...n},a)=>e.jsx(X,{ref:a,className:g("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...n}));Ke.displayName=X.displayName;const ne=c.forwardRef(({className:s,sideOffset:n=4,...a},o)=>e.jsx(pe,{children:e.jsx(_,{ref:o,sideOffset:n,className:g("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...a})}));ne.displayName=_.displayName;const M=c.forwardRef(({className:s,inset:n,...a},o)=>e.jsx(W,{ref:o,className:g("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",n&&"pl-8",s),...a}));M.displayName=W.displayName;const Ze=c.forwardRef(({className:s,children:n,checked:a,...o},t)=>e.jsxs(G,{ref:t,className:g("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(q,{children:e.jsx(J,{className:"h-4 w-4"})})}),n]}));Ze.displayName=G.displayName;const Qe=c.forwardRef(({className:s,children:n,...a},o)=>e.jsxs(K,{ref:o,className:g("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(q,{children:e.jsx(ge,{className:"h-2 w-2 fill-current"})})}),n]}));Qe.displayName=K.displayName;const Ye=c.forwardRef(({className:s,inset:n,...a},o)=>e.jsx(Z,{ref:o,className:g("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...a}));Ye.displayName=Z.displayName;const re=c.forwardRef(({className:s,...n},a)=>e.jsx(Q,{ref:a,className:g("-mx-1 my-1 h-px bg-muted",s),...n}));re.displayName=Q.displayName;function es(s){if(s.length)return s.reduce((n,a)=>a.intensity>n.intensity?a:n,s[0])}function ss(s){return s.length?(s.reduce((n,a)=>n+a.width,0)/s.length).toFixed(3):"-"}function ts(s){const n=s.map(a=>a.crystalliteSize).filter(a=>!!a);return n.length?(n.reduce((a,o)=>a+o,0)/n.length).toFixed(1):"-"}function as(s){const n=new Blob([JSON.stringify(s.peaks,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=`${s.name}-peaks.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}function ns(s){let n=`Peak	Angle (2θ)	Intensity	FWHM	Crystallite Size (nm)
`;n+=s.peaks.map((r,l)=>`${l+1}	${r.angle.toFixed(2)}	${r.intensity.toFixed(0)}	${r.width.toFixed(3)}	${r.crystalliteSize?r.crystalliteSize.toFixed(1):""}`).join(`
`);const a=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(a),t=document.createElement("a");t.href=o,t.download=`${s.name}-peaks.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(o)}function rs(s){let n=`Peak	Angle (2θ)	Intensity	FWHM	Crystallite Size (nm)
`;if(n+=s.peaks.map((a,o)=>`${o+1}	${a.angle.toFixed(2)}	${a.intensity.toFixed(0)}	${a.width.toFixed(3)}	${a.crystalliteSize?a.crystalliteSize.toFixed(1):""}`).join(`
`),navigator.clipboard)navigator.clipboard.writeText(n);else{const a=document.createElement("textarea");a.value=n,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}}const os=({dataset:s})=>{const[n,a]=c.useState(!1),{peaks:o}=s;return e.jsxs(C,{className:"mb-2",children:[e.jsxs(se,{className:"flex flex-row items-center justify-between py-3 px-4 cursor-pointer select-none",onClick:()=>a(t=>!t),children:[e.jsxs("div",{children:[e.jsxs(te,{className:"text-base font-semibold",children:[s.name," – Detected Peaks"]}),e.jsxs("div",{className:"text-xs mt-1 text-muted-foreground",children:[o.length," peaks detected; average FWHM = ",ss(o),"°"]}),e.jsxs("div",{className:"flex gap-4 mt-1 text-xs",children:[e.jsx("span",{children:(()=>{const t=es(o);return t?`Main Peak: ${t.angle.toFixed(2)}° (${t.intensity.toFixed(0)} counts)`:"Main Peak: -"})()}),e.jsxs("span",{children:["Avg. Size: ",ts(o)," nm"]}),e.jsxs("span",{children:["Total: ",o.length]})]})]}),e.jsx("div",{className:"flex flex-col gap-1 items-end",children:e.jsxs(Ge,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(k,{size:"icon",variant:"ghost",className:"h-8 w-8 p-0",onClick:t=>t.stopPropagation(),"aria-label":"Open actions menu",children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs(ne,{align:"end",children:[e.jsx(M,{onClick:t=>{t.stopPropagation(),as(s)},children:"Export JSON"}),e.jsx(M,{onClick:t=>{t.stopPropagation(),ns(s)},children:"Download TXT"}),e.jsx(re,{}),e.jsx(M,{onClick:t=>{t.stopPropagation(),rs(s)},children:"Copy to clipboard"})]})]})})]}),n&&e.jsx(ae,{className:"pt-0 pb-4 px-4",children:o.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"No peaks detected."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs font-mono border-spacing-0",style:{lineHeight:"1.7",minWidth:320},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Angle (2θ)"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Intensity"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"FWHM"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Crystallite Size (nm)"})]})}),e.jsx("tbody",{children:o.map((t,r)=>e.jsxs("tr",{style:{padding:"12px 0"},children:[e.jsx("td",{className:"px-2 py-1",children:r+1}),e.jsx("td",{className:"px-2 py-1",children:t.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1",children:t.intensity.toFixed(0)}),e.jsx("td",{className:"px-2 py-1",children:t.width.toFixed(3)}),e.jsx("td",{className:"px-2 py-1",children:t.crystalliteSize?t.crystalliteSize.toFixed(1):""})]},r))})]})})})]})},oe=c.forwardRef(({className:s,...n},a)=>e.jsx(Y,{ref:a,className:g("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(ye,{className:g("flex items-center justify-center text-current"),children:e.jsx(J,{className:"h-4 w-4"})})}));oe.displayName=Y.displayName;const is=()=>e.jsx("span",{className:"inline-block w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"w-6 h-6 text-primary",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M4 20L20 4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]})}),ls=()=>{const[s,n]=c.useState(!1);return e.jsxs(C,{className:"rounded-none shadow-none border-b bg-primary text-primary-foreground",children:[e.jsxs("nav",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-0",children:[e.jsx(is,{}),e.jsx("span",{className:"text-xl font-bold tracking-tight",children:"XRD Analyzer"})]}),e.jsxs("div",{className:"hidden sm:flex gap-2",children:[e.jsx(k,{variant:"ghost",asChild:!0,children:e.jsx(z,{to:"/",children:"Home"})}),e.jsx(k,{variant:"ghost",asChild:!0,children:e.jsx(z,{to:"/about",children:"About/User Guide"})}),e.jsx(k,{variant:"ghost",asChild:!0,children:e.jsx("a",{href:"#help",children:"Help"})})]}),e.jsx("div",{className:"flex sm:hidden",children:e.jsx(k,{variant:"ghost",size:"icon","aria-label":"Menu",onClick:()=>n(a=>!a),"aria-expanded":s,"aria-controls":"mobile-nav-menu",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})})]}),s&&e.jsxs("div",{id:"mobile-nav-menu",className:"flex flex-col gap-2 px-4 pb-3 sm:hidden animate-fade-in",children:[e.jsx(k,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx(z,{to:"/",children:"Home"})}),e.jsx(k,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx(z,{to:"/about",children:"About/User Guide"})}),e.jsx(k,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx("a",{href:"#help",children:"Help"})})]})]})},A=s=>{const n=s.trim().split(/\r?\n/),a=[];if(n.forEach((o,t)=>{const r=o.trim();if(!r||r.startsWith("#"))return;const l=r.split(/[,\s]+/);if(l.length>=2){const i=parseFloat(l[0]),d=parseFloat(l[1]);!isNaN(i)&&!isNaN(d)?a.push({angle:i,intensity:d}):console.warn(`Skipping invalid data line ${t+1}: ${o}`)}else console.warn(`Skipping malformed line ${t+1}: ${o}`)}),a.length===0)throw new Error("No valid numeric data pairs (angle, intensity) found in the provided text.");return a},ds=(s,n)=>{if(!n.smoothing.enabled)return s;const a=s.map(t=>t.intensity),o=ve(a,1,{windowSize:n.smoothing.windowSize,polynomial:n.smoothing.polynomialOrder});return s.map((t,r)=>({...t,smoothed:o[r]}))},cs=(s,n)=>{switch(n.background.method){case"spline":return us(s,n.background.windowSize);case"rollingBall":return xs(s,n.background.windowSize,n.background.iterations||3);default:return ms(s,n.background.windowSize)}},ms=(s,n)=>s.map((a,o)=>{const t=Math.max(0,o-n),r=Math.min(s.length,o+n),l=s.slice(t,r),i=Math.min(...l.map(d=>d.smoothed??d.intensity));return{...a,backgroundSubtracted:(a.smoothed??a.intensity)-i}}),us=(s,n)=>{const a=s.map((r,l)=>l);s.map(r=>r.smoothed??r.intensity);const o=gs(),t=fs(o.x,o.y,a);return s.map((r,l)=>({...r,backgroundSubtracted:(r.smoothed??r.intensity)-t[l]}))},xs=(s,n,a)=>{let o=s.map(t=>t.smoothed??t.intensity);for(let t=0;t<a;t++)o=bs(o);return s.map((t,r)=>({...t,backgroundSubtracted:(t.smoothed??t.intensity)-o[r]}))},I=(s,n)=>{let a=[];const o=Math.max(...s.map(i=>i.backgroundSubtracted??0));for(let i=1;i<s.length-1;i++){const d=s[i].backgroundSubtracted??0,u=s[i-1].backgroundSubtracted??0,x=s[i+1].backgroundSubtracted??0;let p=!0;if(n.peaks.useMinHeight){let y;o===0?y=n.peaks.minHeight:y=o*n.peaks.minHeight,n.peaks.minHeight===0||d<=y&&(p=!1)}(d<=u||d<=x)&&(p=!1),p&&a.push({index:i,intensity:d})}a.sort((i,d)=>d.intensity-i.intensity);const t=[];for(let i of a)n.peaks.useMinDistance&&t.some(d=>Math.abs(s[d].angle-s[i.index].angle)<n.peaks.minDistance)||t.push(i.index);const r=[];for(let i of t){let d=i,u=i;for(;d>0&&(s[d].backgroundSubtracted??0)>=(s[d-1].backgroundSubtracted??0);)d--;for(;u<s.length-1&&(s[u].backgroundSubtracted??0)>=(s[u+1].backgroundSubtracted??0);)u++;const x=s[d].backgroundSubtracted??0,p=s[u].backgroundSubtracted??0,h=(s[i].backgroundSubtracted??0)-Math.max(x,p);n.peaks.useMinProminence&&h<n.peaks.minProminence||r.push(i)}const l=[];for(let i of r){const d=hs(s,i),u=ps(d.width,n.peaks.wavelength,n.peaks.instrumentBroadening);l.push({...d,crystalliteSize:u})}return l},hs=(s,n)=>{const a=s[n].backgroundSubtracted??0,o=s[n].angle,t=20,r=Math.max(0,n-t),l=Math.min(s.length,n+t),i=s.slice(r,l).map(y=>y.angle),d=s.slice(r,l).map(y=>y.backgroundSubtracted??0),u=js(i,d,o,a),x=ys(i,d,o,a),p=u.rSquared>x.rSquared?u:x;return{angle:p.params.center,intensity:p.params.amplitude,width:p.params.width,area:vs(),fit:{type:p.type,params:p.params}}},ps=(s,n,a)=>{const t=Math.sqrt(Math.pow(s,2)-Math.pow(a,2)),r=s/2*Math.PI/180;return .9*n/(t*Math.cos(r))},gs=()=>({x:[],y:[]}),fs=(s,n,a)=>new Array(a.length).fill(0),bs=s=>s,js=(s,n,a,o)=>({type:"gaussian",params:{center:a,amplitude:o,width:1},rSquared:.9}),ys=(s,n,a,o)=>({type:"lorentzian",params:{center:a,amplitude:o,width:1},rSquared:.8}),vs=s=>1,T=c.forwardRef(({className:s,...n},a)=>e.jsx("textarea",{className:g("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...n}));T.displayName="Textarea";const ie=c.createContext(void 0),Ns=({children:s})=>{const[n,a]=c.useState(null),o=c.useCallback((r,l)=>{a({message:r,type:l}),setTimeout(()=>a(null),4e3)},[]),t=c.useCallback(()=>a(null),[]);return e.jsx(ie.Provider,{value:{notification:n,showNotification:o,clearNotification:t},children:s})},le=()=>{const s=c.useContext(ie);if(!s)throw new Error("useNotification must be used within a NotificationProvider");return s},U=({onFileAccepted:s,accept:n=[".csv",".txt",".dat"],label:a="Upload File",description:o="CSV, TXT, or DAT files (drag and drop or click)",className:t=""})=>{const{getRootProps:r,getInputProps:l,isDragActive:i,open:d}=Ne({accept:n.reduce((u,x)=>({...u,[x]:[]}),{}),multiple:!1,noClick:!0,onDrop:u=>{u.length>0&&s(u[0])}});return e.jsxs(C,{...r({className:"flex flex-col items-center justify-center border-dashed border-2 border-muted-foreground/30 p-6 rounded-lg cursor-pointer transition-colors hover:border-primary/60 bg-background "+(i?"bg-accent/30 border-primary/80 ":"")+t}),tabIndex:0,"aria-label":typeof a=="string"?a:"File Upload",children:[e.jsx("input",{...l()}),e.jsxs("div",{className:"flex flex-col items-center text-muted-foreground mb-2",children:[e.jsx(we,{size:40,className:"mb-2"}),e.jsx("span",{className:"font-semibold",children:a}),e.jsx("span",{className:"text-xs text-center",children:o})]}),e.jsx(k,{type:"button",onClick:d,className:"mt-2",variant:"outline",children:"Select File"})]})},ws=({onDataLoaded:s,hasSample:n,hasReference:a,onAddSample:o,onAddReference:t})=>{const{showNotification:r}=le(),[l,i]=R.useState(!1),[d,u]=R.useState(!1),x=c.useCallback((f,j)=>{const N=new FileReader;N.onload=ce=>{var E;try{const F=(E=ce.target)==null?void 0:E.result,$=A(F);if(!$.length)throw new Error("No valid data found.");s($,f.name,j),r(`Loaded ${j==="sample"?"sample":"reference"}: ${f.name}`,"success")}catch(F){r(`Failed to parse ${j==="sample"?"file":"reference"}: ${F.message}`,"error")}},N.onerror=()=>r(`Error reading ${j==="sample"?"file":"reference"} file.`,"error"),N.readAsText(f)},[s,r]),p=c.useCallback((f,j)=>{x(f,j),j==="sample"&&i(!1),j==="reference"&&u(!1)},[x]),y=c.useCallback(f=>{const j=f.target.value;try{if(j){const N=A(j);if(!N.length)throw new Error("No valid data found in pasted text.");s(N,"Pasted Data","sample"),r("Loaded pasted data.","success")}}catch(N){r(`Failed to parse pasted data: ${N.message}`,"error")}},[s,r]),[h,b]=R.useState(!1),[m,v]=R.useState(!1);return e.jsxs("div",{className:"w-full max-w-3xl mx-auto mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border p-6 flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ke,{size:22,className:"text-indigo-600 mr-2"}),e.jsx("h2",{className:"font-bold text-lg",children:"Upload Sample Data"})]}),e.jsx(U,{onFileAccepted:f=>p(f,"sample"),label:null,description:"CSV, TXT, or DAT files (drag and drop or click)"}),e.jsx("button",{className:"text-xs mt-4 text-indigo-700 hover:underline self-start",type:"button",onClick:()=>b(f=>!f),children:h?"Hide Paste Data":"Paste Data Instead"}),h&&e.jsx("div",{className:"mt-2",children:e.jsx(T,{rows:4,placeholder:"Paste your XRD data here (angle,intensity format)",onChange:y,className:"w-full"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border p-6 flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ce,{size:22,className:"text-teal-600 mr-2"}),e.jsx("h2",{className:"font-bold text-lg",children:"Upload Reference Pattern"})]}),e.jsx(U,{onFileAccepted:f=>p(f,"reference"),label:null,description:"CSV, TXT, or DAT files (drag and drop or click)"}),e.jsx("button",{className:"text-xs mt-4 text-teal-700 hover:underline self-start",type:"button",onClick:()=>v(f=>!f),children:m?"Hide Paste Data":"Paste Data Instead"}),m&&e.jsx("div",{className:"mt-2",children:e.jsx(T,{rows:4,placeholder:"Paste your XRD reference pattern here (angle,intensity format)",onChange:f=>{const j=f.target.value;try{if(j){const N=A(j);if(!N.length)throw new Error("No valid data found in pasted text.");s(N,"Pasted Reference","reference"),r("Loaded pasted reference.","success")}}catch(N){r(`Failed to parse pasted reference: ${N.message}`,"error")}},className:"w-full"})})]})]})},ks=({datasets:s,peakMatches:n})=>{const a=[];s.forEach((t,r)=>{const l=t.color;if(!t.visible)return;const i=t.data.map(x=>x.angle),d=t.data.map(x=>x.backgroundSubtracted??x.intensity),u=`dataset-${r}`;a.push({x:i,y:d,type:"scatter",mode:"lines",name:t.name,legendgroup:u,line:{color:l,width:1}}),t.peaks&&t.peaks.length>0&&a.push({x:t.peaks.map(x=>x.angle),y:t.peaks.map(x=>x.intensity),mode:"markers",type:"scatter",name:"Peaks",legendgroup:u,marker:{color:l,size:8,symbol:"circle",line:{color:"black",width:0}},hoverinfo:"text",text:t.peaks.map((x,p)=>`Peak ${p+1}: ${x.angle.toFixed(2)}°<br>Intensity: ${x.intensity.toFixed(0)}`)})}),n&&n.length>0&&a.push({x:n.map(t=>t.samplePeak.angle),y:n.map(t=>t.samplePeak.intensity),mode:"markers",type:"scatter",name:"Matched Peaks",marker:{color:"red",size:8,symbol:"star",line:{color:"black",width:0}},hoverinfo:"text",text:n.map(t=>`Sample: ${t.sampleDataset}<br>Ref: ${t.referenceDataset}<br>Δ: ${t.delta.toFixed(3)}°`)});const o={title:"XRD Pattern Analysis",xaxis:{title:"2θ (degrees)"},yaxis:{title:"Intensity (a.u.)"},legend:{orientation:"h",x:.5,xanchor:"center",y:1.15,yanchor:"bottom",traceorder:"grouped",itemsizing:"constant",itemwidth:30,groupgap:40,tracegroupgap:5},autosize:!0,margin:{t:50,l:50,r:30,b:50},plot_bgcolor:"white",paper_bgcolor:"white",font:{family:"inherit",size:14}};return e.jsx("div",{className:"w-full max-w-full h-[300px] sm:h-[400px] md:h-[500px] overflow-x-auto",children:e.jsx(Se,{data:a,layout:o,useResizeHandler:!0,style:{width:"100%",height:"100%"},config:{responsive:!0,displaylogo:!1,toImageButtonOptions:{format:"png",filename:"xrd-pattern",height:500,width:900,scale:2}}})})},Cs=De,P=Re,D=ze,w=c.forwardRef(({className:s,sideOffset:n=4,...a},o)=>e.jsx(Pe,{children:e.jsx(ee,{ref:o,sideOffset:n,className:g("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...a})}));w.displayName=ee.displayName;const Ss=({params:s,onParamsChange:n})=>{const[a,o]=R.useState(!1),t=(r,l,i)=>{n({...s,[r]:{...s[r],[l]:i}})};return e.jsx(Cs,{children:e.jsx("div",{className:"space-y-6 p-4 bg-white rounded-md shadow-sm max-w-full sm:max-w-lg mx-auto",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Processing Parameters"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center font-medium text-gray-700 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.smoothing.enabled,onChange:r=>t("smoothing","enabled",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2"}),"Smoothing"]}),s.smoothing.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Window Size",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Number of points used for smoothing window."})]})]}),e.jsx("input",{type:"number",value:s.smoothing.windowSize,onChange:r=>t("smoothing","windowSize",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Polynomial Order",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Order of the polynomial used for Savitzky-Golay smoothing."})]})]}),e.jsx("input",{type:"number",value:s.smoothing.polynomialOrder,onChange:r=>t("smoothing","polynomialOrder",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center font-medium text-gray-700 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.background.enabled,onChange:r=>t("background","enabled",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2"}),"Background Subtraction"]}),s.background.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:s.background.method,onChange:r=>t("background","method",r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"sliding",children:"Sliding Window"}),e.jsx("option",{value:"spline",children:"Spline Fitting"}),e.jsx("option",{value:"rollingBall",children:"Rolling Ball"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Window Size",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Number of points used for smoothing window."})]})]}),e.jsx("input",{type:"number",value:s.background.windowSize,onChange:r=>t("background","windowSize",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),s.background.method==="rollingBall"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Iterations",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Number of times the rolling ball algorithm is applied."})]})]}),e.jsx("input",{type:"number",value:s.background.iterations,onChange:r=>t("background","iterations",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Peak Analysis"}),e.jsx("div",{className:"mt-2 flex flex-col gap-2",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:s.peaks.useMinHeight,onChange:r=>t("peaks","useMinHeight",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Height (%)",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Only peaks above this relative height (percent of max intensity) are detected."})]})]})]}),s.peaks.useMinHeight&&e.jsx("input",{type:"number",value:s.peaks.minHeight*100,onChange:r=>t("peaks","minHeight",parseFloat(r.target.value)/100),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:s.peaks.useMinDistance,onChange:r=>t("peaks","useMinDistance",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Distance (°)",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Minimum angular distance between detected peaks."})]})]})]}),s.peaks.useMinDistance&&e.jsx("input",{type:"number",value:s.peaks.minDistance,onChange:r=>t("peaks","minDistance",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:s.peaks.useMinProminence,onChange:r=>t("peaks","useMinProminence",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Prominence",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Only peaks with a prominence above this value are detected."})]})]})]}),s.peaks.useMinProminence&&e.jsx("input",{type:"number",value:s.peaks.minProminence,onChange:r=>t("peaks","minProminence",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between items-center px-4 py-2 bg-gray-100 rounded text-gray-700 font-medium border border-gray-200 hover:bg-gray-200 transition",onClick:()=>o(r=>!r),"aria-expanded":a,children:["Advanced Settings",e.jsx("span",{className:"ml-2",children:a?"▲":"▼"})]}),a&&e.jsxs("div",{className:"mt-4 space-y-4 bg-gray-50 rounded p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Instrument Broadening (°)",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"Instrumental peak broadening value in degrees 2θ."})]})]}),e.jsx("input",{type:"number",value:s.peaks.instrumentBroadening,onChange:r=>t("peaks","instrumentBroadening",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Wavelength (Å)",e.jsxs(P,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(S,{size:16})})}),e.jsx(w,{children:"X-ray wavelength used for conversion and analysis."})]})]}),e.jsx("input",{type:"number",value:s.peaks.wavelength,onChange:r=>t("peaks","wavelength",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})]})]})})})},Ps=O("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),de=c.forwardRef(({className:s,variant:n,...a},o)=>e.jsx("div",{ref:o,role:"alert",className:g(Ps({variant:n}),s),...a}));de.displayName="Alert";const Ds=c.forwardRef(({className:s,...n},a)=>e.jsx("h5",{ref:a,className:g("mb-1 font-medium leading-none tracking-tight",s),...n}));Ds.displayName="AlertTitle";const Rs=c.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:g("text-sm [&_p]:leading-relaxed",s),...n}));Rs.displayName="AlertDescription";const zs={success:void 0,info:void 0,error:"destructive"},Ms=()=>{const{notification:s,clearNotification:n}=le();return s?e.jsx("div",{className:"fixed top-4 left-1/2 z-50 -translate-x-1/2 w-full max-w-md px-2",children:e.jsx(de,{variant:zs[s.type],className:"shadow-lg cursor-pointer",onClick:n,children:s.message})}):null},Fs=()=>e.jsx("div",{className:"bg-background min-h-screen",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto my-8 p-4 md:p-8",children:[e.jsxs(C,{className:"p-6 mb-8 shadow-md bg-card",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-primary",children:"About XRD Analyzer"}),e.jsxs("p",{className:"text-lg mb-6",children:[e.jsx("span",{className:"font-semibold",children:"XRD Analyzer"})," is a web-based tool for visualizing and analyzing X-ray diffraction (XRD) data. It supports common file formats (CSV, TXT, DAT) and provides interactive plotting, data processing, and peak analysis features."]})]}),e.jsxs(C,{className:"p-6 mb-8 shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center text-primary",children:[e.jsx(Me,{className:"mr-2 h-6 w-6"}),"User Guide"]}),e.jsxs("ol",{className:"list-decimal pl-6 space-y-4",children:[e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-5 w-5 text-primary"}),"Upload Data"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Use the file upload section to import your XRD data files. Supported formats: CSV, TXT, DAT."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Ae,{className:"mr-2 h-5 w-5 text-primary"}),"Plot Visualization"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Uploaded data will be plotted interactively. Zoom, pan, and hover for details."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Processing Tools"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Apply background subtraction, smoothing, normalization, and baseline correction using the controls provided."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5 text-primary"}),"Peak Detection"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Detect peaks with adjustable sensitivity. Peaks will be marked on the plot."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Phase Identification"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"(Optional) Upload a reference pattern for phase identification or use the built-in simple matcher."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Te,{className:"mr-2 h-5 w-5 text-primary"}),"Export"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Download processed data as CSV or the plot as PNG."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs(C,{className:"p-6 shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-primary",children:"Features"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{className:"text-muted-foreground",children:"Interactive XRD plotting (Plotly.js)"}),e.jsx("li",{className:"text-muted-foreground",children:"Data processing: background subtraction, smoothing, normalization, baseline correction"}),e.jsx("li",{className:"text-muted-foreground",children:"Peak detection with adjustable sensitivity"}),e.jsx("li",{className:"text-muted-foreground",children:"Phase identification (simple or user-uploaded reference)"}),e.jsx("li",{className:"text-muted-foreground",children:"Export options: CSV, PNG"}),e.jsx("li",{className:"text-muted-foreground",children:"Responsive, user-friendly interface"})]})]}),e.jsxs(C,{className:"p-6 shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center text-primary",children:[e.jsx(Ee,{className:"mr-2 h-6 w-6"}),"Contact & Feedback"]}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"For questions, feedback, or bug reports, please visit the GitHub repository or contact me via email."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("a",{href:"https://github.com/jovenpaoloangeles/xrd-analyzer/",className:"inline-block px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",target:"_blank",rel:"noopener noreferrer",children:"GitHub Repository"}),e.jsx("a",{href:"mailto:jovenpaoloangeles@gmail.com",className:"inline-block px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors",children:"jovenpaoloangeles@gmail.com"})]})]})]})]})});function As(s,n,a=.2){const o=[];return s.forEach(t=>{n.forEach(r=>{t.peaks.forEach(l=>{const i=r.peaks.reduce((d,u)=>{const x=Math.abs(l.angle-u.angle);return x<d.delta?{peak:u,delta:x}:d},{peak:null,delta:1/0});i.peak&&i.delta<=a&&o.push({samplePeak:l,referencePeak:i.peak,sampleDataset:t.name,referenceDataset:r.name,delta:i.delta})})})}),o}const Is={smoothing:{enabled:!1,windowSize:5,polynomialOrder:2},background:{enabled:!1,method:"sliding",windowSize:20,iterations:3},peaks:{minHeight:.1,minDistance:.5,minProminence:10,instrumentBroadening:.1,wavelength:1.5406,useMinHeight:!1,useMinDistance:!1,useMinProminence:!1}},L=["#4477AA","#EE6677","#228833","#CCBB44","#66CCEE","#AA3377","#BBBBBB"],Ts=s=>L[s%L.length];function Es(){const[s,n]=c.useState([]),[a,o]=c.useState(!1),[t,r]=c.useState(Is),[l,i]=c.useState([]),[d,u]=c.useState(!1),x=c.useCallback(h=>{let b=h.map(m=>({...m}));return b=ds(b,t),b=cs(b,t),b},[t]),p=c.useCallback((h,b,m)=>{const v=x(h),f=I(v,t);n(j=>[...j,{id:`${m}-${Date.now()}`,name:b,type:m,color:Ts(j.length),data:v,peaks:f,visible:!0}]),m==="sample"&&o(!0)},[x,t]),y=c.useCallback(h=>{r(h),u(!0),n(b=>b.map(m=>{const v=x(m.data),f=I(v,h);return{...m,data:v,peaks:f}})),setTimeout(()=>u(!1),300)},[x]);return R.useEffect(()=>{u(!0),n(h=>h.map(b=>{const m=x(b.data),v=I(m,t);return{...b,data:m,peaks:v}})),setTimeout(()=>u(!1),300)},[t]),e.jsxs(Ns,{children:[e.jsx(Ms,{}),e.jsx($e,{children:e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx(ls,{}),e.jsxs(Be,{children:[e.jsx(B,{path:"/",element:e.jsx("div",{className:"max-w-[1400px] mx-auto my-8 p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold mr-4",children:"Data Input"}),e.jsx("button",{className:"ml-auto px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm",onClick:()=>o(h=>!h),children:a?"Show Data Input":"Hide Data Input"})]}),!a&&e.jsx(C,{className:"mb-6 p-4",children:e.jsx(ws,{onDataLoaded:p,hasSample:s.some(h=>h.type==="sample"),hasReference:s.some(h=>h.type==="reference"),onAddSample:()=>o(!1),onAddReference:()=>o(!1)})}),s.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Loaded Patterns"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:s.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-4 h-4 rounded-full mr-2",style:{background:h.color}}),e.jsx("span",{className:"font-medium text-sm",children:h.name})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[e.jsx(oe,{checked:h.visible,onCheckedChange:()=>n(b=>b.map(m=>m.id===h.id?{...m,visible:!m.visible}:m))}),e.jsx("span",{className:"text-xs",children:"Show"})]})]},h.id))})]}),(()=>{const h=s.filter(m=>m.visible&&m.type==="sample"),b=s.filter(m=>m.visible&&m.type==="reference");return R.useEffect(()=>{i(As(h,b))},[s]),s.filter(m=>m.visible).length>0?e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"XRD Pattern"}),e.jsxs("div",{className:"md:col-span-2 col-span-1 relative",children:[e.jsx(ks,{datasets:s.filter(m=>m.visible),peakMatches:l}),d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 z-20",children:e.jsx(He,{className:"animate-spin w-16 h-16 text-primary"})})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{className:"px-4 py-2 rounded bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow",onClick:()=>Ve(()=>import("./exportCSV-Sq8kO-19.js"),[]).then(m=>m.exportDatasetsToCSV(s.filter(v=>v.visible))),children:"Export CSV"})}),l.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Phase Match Summary"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border bg-background",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 border",children:"Sample"}),e.jsx("th",{className:"px-2 py-1 border",children:"Reference"}),e.jsx("th",{className:"px-2 py-1 border",children:"Sample Peak (°2θ)"}),e.jsx("th",{className:"px-2 py-1 border",children:"Reference Peak (°2θ)"}),e.jsx("th",{className:"px-2 py-1 border",children:"Δ (°2θ)"})]})}),e.jsx("tbody",{children:l.map((m,v)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:m.sampleDataset}),e.jsx("td",{className:"px-2 py-1 border",children:m.referenceDataset}),e.jsx("td",{className:"px-2 py-1 border",children:m.samplePeak.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1 border",children:m.referencePeak.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1 border",children:m.delta.toFixed(3)})]},v))})]})})]})]}):null})(),s.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Analysis Results"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:s.map(h=>e.jsx(os,{dataset:h},h.id))})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Processing Controls"}),e.jsx(C,{className:"p-4",children:e.jsx(Ss,{params:t,onParamsChange:y})})]})]})})}),e.jsx(B,{path:"/about",element:e.jsx(Fs,{})})]})]})})]})}Ue(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Es,{})}));
