import{t as te,c as se,r as x,j as e,S as ne,a as U,M as ae,C as re,b as W,d as V,e as oe,f as ie,g as le,h as X,i as de,k as ce,l as me,m as ue,n as xe,o as he,p as pe,q as ge,s as fe,L as z,u as be,v as je,U as ye,R,F as ve,D as Ne,P as we,T as ke,w as Ce,x as Se,y as E,z as Pe,A as De,H as N,B as Re,E as ze,G as Me,Z as _e,I as Fe,J as Ie,K as Te,N as Ae,O as $,Q as Ee,V as $e}from"./vendor-D0o3-_Nt.js";import"./plotly-D30ycGar.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const Be="modulepreload",Oe=function(t){return"/xrd-analyzer/"+t},B={},Le=function(s,n,o){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(n.map(d=>{if(d=Oe(d),d in B)return;B[d]=!0;const m=d.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":Be,m||(g.as="script"),g.crossOrigin="",g.href=d,i&&g.setAttribute("nonce",i),document.head.appendChild(g),m)return new Promise((f,b)=>{g.addEventListener("load",f),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return a.then(l=>{for(const i of l||[])i.status==="rejected"&&r(i.reason);return s().catch(r)})};function j(...t){return te(se(t))}const S=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("rounded-xl border bg-card text-card-foreground shadow",t),...s}));S.displayName="Card";const G=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("flex flex-col space-y-1.5 p-6",t),...s}));G.displayName="CardHeader";const q=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("font-semibold leading-none tracking-tight",t),...s}));q.displayName="CardTitle";const He=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("text-sm text-muted-foreground",t),...s}));He.displayName="CardDescription";const J=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("p-6 pt-0",t),...s}));J.displayName="CardContent";const Ue=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("flex items-center p-6 pt-0",t),...s}));Ue.displayName="CardFooter";const We=U("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),C=x.forwardRef(({className:t,variant:s,size:n,asChild:o=!1,...a},r)=>{const l=o?ne:"button";return e.jsx(l,{className:j(We({variant:s,size:n,className:t})),ref:r,...a})});C.displayName="Button";const Ve=xe,Xe=he,Ge=x.forwardRef(({className:t,inset:s,children:n,...o},a)=>e.jsxs(ae,{ref:a,className:j("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...o,children:[n,e.jsx(re,{className:"ml-auto"})]}));Ge.displayName="DropdownMenuSubTrigger";const qe=x.forwardRef(({className:t,...s},n)=>e.jsx(W,{children:e.jsx(V,{ref:n,className:j("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s})}));qe.displayName="DropdownMenuSubContent";const K=x.forwardRef(({className:t,sideOffset:s=4,...n},o)=>e.jsx(oe,{children:e.jsx(W,{sideOffset:s,children:e.jsx(V,{ref:o,className:j("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})})}));K.displayName="DropdownMenuContent";const M=x.forwardRef(({className:t,inset:s,...n},o)=>e.jsx(ie,{ref:o,className:j("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...n}));M.displayName="DropdownMenuItem";const Je=x.forwardRef(({className:t,children:s,checked:n,...o},a)=>e.jsxs(le,{ref:a,className:j("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(void 0,{children:e.jsx(X,{className:"h-4 w-4"})})}),s]}));Je.displayName="DropdownMenuCheckboxItem";const Ke=x.forwardRef(({className:t,children:s,...n},o)=>e.jsxs(de,{ref:o,className:j("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ce,{children:e.jsx(me,{className:"h-2 w-2 fill-current"})})}),s]}));Ke.displayName="DropdownMenuRadioItem";const Ye=x.forwardRef(({className:t,inset:s,...n},o)=>e.jsx("div",{ref:o,className:j("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));Ye.displayName="DropdownMenuLabel";const Y=x.forwardRef(({className:t,...s},n)=>e.jsx(ue,{ref:n,className:j("-mx-1 my-1 h-px bg-muted",t),...s}));Y.displayName="DropdownMenuSeparator";function Ze(t){if(t.length)return t.reduce((s,n)=>n.intensity>s.intensity?n:s,t[0])}function Qe(t){return t.length?(t.reduce((s,n)=>s+n.width,0)/t.length).toFixed(3):"-"}function et(t){const s=t.map(n=>n.crystalliteSize).filter(n=>!!n);return s.length?(s.reduce((n,o)=>n+o,0)/s.length).toFixed(1):"-"}function tt(t){const s=new Blob([JSON.stringify(t.peaks,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=`${t.name}-peaks.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}function st(t){let s=`Peak	Angle (2θ)	Intensity	FWHM	Crystallite Size (nm)
`;s+=t.peaks.map((r,l)=>`${l+1}	${r.angle.toFixed(2)}	${r.intensity.toFixed(0)}	${r.width.toFixed(3)}	${r.crystalliteSize?r.crystalliteSize.toFixed(1):""}`).join(`
`);const n=new Blob([s],{type:"text/plain"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`${t.name}-peaks.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function nt(t){let s=`Peak	Angle (2θ)	Intensity	FWHM	Crystallite Size (nm)
`;if(s+=t.peaks.map((n,o)=>`${o+1}	${n.angle.toFixed(2)}	${n.intensity.toFixed(0)}	${n.width.toFixed(3)}	${n.crystalliteSize?n.crystalliteSize.toFixed(1):""}`).join(`
`),navigator.clipboard)navigator.clipboard.writeText(s);else{const n=document.createElement("textarea");n.value=s,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}const at=({dataset:t})=>{const[s,n]=x.useState(!1),{peaks:o}=t;return e.jsxs(S,{className:"mb-2",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between py-3 px-4 cursor-pointer select-none",onClick:()=>n(a=>!a),children:[e.jsxs("div",{children:[e.jsxs(q,{className:"text-base font-semibold",children:[t.name," – Detected Peaks"]}),e.jsxs("div",{className:"text-xs mt-1 text-muted-foreground",children:[o.length," peaks detected; average FWHM = ",Qe(o),"°"]}),e.jsxs("div",{className:"flex gap-4 mt-1 text-xs",children:[e.jsx("span",{children:(()=>{const a=Ze(o);return a?`Main Peak: ${a.angle.toFixed(2)}° (${a.intensity.toFixed(0)} counts)`:"Main Peak: -"})()}),e.jsxs("span",{children:["Avg. Size: ",et(o)," nm"]}),e.jsxs("span",{children:["Total: ",o.length]})]})]}),e.jsx("div",{className:"flex flex-col gap-1 items-end",children:e.jsxs(Ve,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx(C,{size:"icon",variant:"ghost",className:"h-8 w-8 p-0",onClick:a=>a.stopPropagation(),"aria-label":"Open actions menu",children:e.jsx(pe,{className:"w-5 h-5"})})}),e.jsxs(K,{align:"end",children:[e.jsx(M,{onClick:a=>{a.stopPropagation(),tt(t)},children:"Export JSON"}),e.jsx(M,{onClick:a=>{a.stopPropagation(),st(t)},children:"Download TXT"}),e.jsx(Y,{}),e.jsx(M,{onClick:a=>{a.stopPropagation(),nt(t)},children:"Copy to clipboard"})]})]})})]}),s&&e.jsx(J,{className:"pt-0 pb-4 px-4",children:o.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"No peaks detected."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs font-mono border-spacing-0",style:{lineHeight:"1.7",minWidth:320},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Angle (2θ)"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Intensity"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"FWHM"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Crystallite Size (nm)"})]})}),e.jsx("tbody",{children:o.map((a,r)=>e.jsxs("tr",{style:{padding:"12px 0"},children:[e.jsx("td",{className:"px-2 py-1",children:r+1}),e.jsx("td",{className:"px-2 py-1",children:a.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1",children:a.intensity.toFixed(0)}),e.jsx("td",{className:"px-2 py-1",children:a.width.toFixed(3)}),e.jsx("td",{className:"px-2 py-1",children:a.crystalliteSize?a.crystalliteSize.toFixed(1):""})]},r))})]})})})]})},T=x.forwardRef(({className:t,...s},n)=>e.jsx(ge,{ref:n,className:j("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(fe,{className:j("flex items-center justify-center text-current"),children:e.jsx(X,{className:"h-4 w-4"})})}));T.displayName="Checkbox";const rt=()=>e.jsx("span",{className:"inline-block w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"w-6 h-6 text-primary",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M4 20L20 4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]})}),ot=()=>{const[t,s]=x.useState(!1);return e.jsxs(S,{className:"rounded-none shadow-none border-b bg-primary text-primary-foreground",children:[e.jsxs("nav",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-0",children:[e.jsx(rt,{}),e.jsx("span",{className:"text-xl font-bold tracking-tight",children:"XRD Analyzer"})]}),e.jsxs("div",{className:"hidden sm:flex gap-2",children:[e.jsx(C,{variant:"ghost",asChild:!0,children:e.jsx(z,{to:"/",children:"Home"})}),e.jsx(C,{variant:"ghost",asChild:!0,children:e.jsx(z,{to:"/about",children:"About/User Guide"})}),e.jsx(C,{variant:"ghost",asChild:!0,children:e.jsx("a",{href:"#help",children:"Help"})})]}),e.jsx("div",{className:"flex sm:hidden",children:e.jsx(C,{variant:"ghost",size:"icon","aria-label":"Menu",onClick:()=>s(n=>!n),"aria-expanded":t,"aria-controls":"mobile-nav-menu",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})})]}),t&&e.jsxs("div",{id:"mobile-nav-menu",className:"flex flex-col gap-2 px-4 pb-3 sm:hidden animate-fade-in",children:[e.jsx(C,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx(z,{to:"/",children:"Home"})}),e.jsx(C,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx(z,{to:"/about",children:"About/User Guide"})}),e.jsx(C,{variant:"ghost",asChild:!0,className:"w-full justify-start",children:e.jsx("a",{href:"#help",children:"Help"})})]})]})},it=(t,s={enabled:!1})=>{if(!s.enabled)return[...t];const{windowSize:n=5,polynomial:o=2}=s;if(t.length<n)return[...t];try{const a=be(t,1,{windowSize:n,polynomial:o}),r=Math.floor(n/2),l=t.slice(0,r),i=t.slice(t.length-r);return[...l,...a,...i]}catch(a){return console.error("Smoothing failed",a),[...t]}},lt=(t,s,n={enabled:!1})=>{if(!n.enabled)return{corrected:[...s],background:new Array(s.length).fill(0)};const o=Math.min(...s),a=new Array(s.length).fill(o);return{corrected:s.map(l=>l-o),background:a}},dt=(t,s)=>{let n=[];const o=Math.max(...t.map(i=>i.backgroundSubtracted??0));for(let i=1;i<t.length-1;i++){const d=t[i].backgroundSubtracted??0,m=t[i-1].backgroundSubtracted??0,p=t[i+1].backgroundSubtracted??0;let g=!0;if(s.peaks.useMinHeight){let f;o===0?f=s.peaks.minHeight:f=o*s.peaks.minHeight,d<=f&&(g=!1)}(d<=m||d<=p)&&(g=!1),g&&n.push({index:i,intensity:d})}n.sort((i,d)=>d.intensity-i.intensity);const a=[];for(let i of n)s.peaks.useMinDistance&&a.some(d=>Math.abs(t[d].angle-t[i.index].angle)<s.peaks.minDistance)||a.push(i.index);const r=[];for(let i of a){let d=i,m=i;for(;d>0&&(t[d].backgroundSubtracted??0)>=(t[d-1].backgroundSubtracted??0);)d--;for(;m<t.length-1&&(t[m].backgroundSubtracted??0)>=(t[m+1].backgroundSubtracted??0);)m++;const p=t[d].backgroundSubtracted??0,g=t[m].backgroundSubtracted??0,b=(t[i].backgroundSubtracted??0)-Math.max(p,g);s.peaks.useMinProminence&&b<s.peaks.minProminence||r.push(i)}const l=[];for(let i of r){const d=ct(t,i),m=mt(d.angle,d.width,s.peaks.wavelength,s.peaks.instrumentBroadening);l.push({...d,crystalliteSize:m})}return l.sort((i,d)=>i.angle-d.angle)},ct=(t,s)=>{const n=t[s].backgroundSubtracted??0,o=t[s].angle,a=20,r=Math.max(0,s-a),l=Math.min(t.length,s+a),i=t.slice(r,l).map(f=>f.angle),d=t.slice(r,l).map(f=>f.backgroundSubtracted??0),m=ut(i,d,o,n),p=xt(i,d,o,n),g=m.rSquared>p.rSquared?m:p;return{angle:g.params.center,intensity:g.params.amplitude,width:g.params.width,area:ht(),fit:{type:g.type,params:g.params}}},mt=(t,s,n,o)=>{const r=Math.pow(s,2)-Math.pow(o,2),l=(r>0?Math.sqrt(r):s)*(Math.PI/180),i=t/2*(Math.PI/180);return .9*n/(l*Math.cos(i))},ut=(t,s,n,o)=>({type:"gaussian",params:{center:n,amplitude:o,width:.1},rSquared:.9}),xt=(t,s,n,o)=>({type:"lorentzian",params:{center:n,amplitude:o,width:.1},rSquared:.8}),ht=t=>1,_=t=>{const s=t.trim().split(/\r?\n/),n=[];if(s.forEach((o,a)=>{const r=o.trim();if(!r||r.startsWith("#"))return;const l=r.split(/[,\s]+/);if(l.length>=2){const i=parseFloat(l[0]),d=parseFloat(l[1]);!isNaN(i)&&!isNaN(d)?n.push({angle:i,intensity:d}):console.warn(`Skipping invalid data line ${a+1}: ${o}`)}else console.warn(`Skipping malformed line ${a+1}: ${o}`)}),n.length===0)throw new Error("No valid numeric data pairs (angle, intensity) found in the provided text.");return n},pt=(t,s)=>{const n=t.map(a=>a.intensity),o=it(n,{enabled:s.smoothing.enabled,windowSize:s.smoothing.windowSize,polynomial:s.smoothing.polynomialOrder});return t.map((a,r)=>({...a,smoothed:o[r]}))},gt=(t,s)=>{if(!s.background.enabled)return t.map(n=>({...n,backgroundSubtracted:n.smoothed??n.intensity}));if(s.background.method==="sliding"||!s.background.method){const n=t.map(r=>r.smoothed??r.intensity),o=t.map(r=>r.angle),a=lt(o,n,{enabled:!0});return t.map((r,l)=>({...r,backgroundSubtracted:a.corrected[l]}))}switch(s.background.method){case"spline":return bt(t,s.background.windowSize);case"rollingBall":return jt(t,s.background.windowSize,s.background.iterations||3);default:return ft(t,s.background.windowSize)}},ft=(t,s)=>t.map((n,o)=>{const a=Math.max(0,o-s),r=Math.min(t.length,o+s),l=t.slice(a,r),i=Math.min(...l.map(d=>d.smoothed??d.intensity));return{...n,backgroundSubtracted:(n.smoothed??n.intensity)-i}}),bt=(t,s)=>{const n=t.map((r,l)=>l),o=yt(),a=vt(o.x,o.y,n);return t.map((r,l)=>({...r,backgroundSubtracted:(r.smoothed??r.intensity)-a[l]}))},jt=(t,s,n)=>{let o=t.map(a=>a.smoothed??a.intensity);for(let a=0;a<n;a++)o=Nt(o);return t.map((a,r)=>({...a,backgroundSubtracted:(a.smoothed??a.intensity)-o[r]}))},F=(t,s)=>dt(t,s),O=(t,s,n)=>n==="waterfall"?t*s:0,yt=()=>({x:[],y:[]}),vt=(t,s,n)=>new Array(n.length).fill(0),Nt=t=>t,I=x.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:j("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));I.displayName="Textarea";const Z=x.createContext(void 0),wt=({children:t})=>{const[s,n]=x.useState(null),o=x.useCallback((r,l)=>{n({message:r,type:l}),setTimeout(()=>n(null),4e3)},[]),a=x.useCallback(()=>n(null),[]);return e.jsx(Z.Provider,{value:{notification:s,showNotification:o,clearNotification:a},children:t})},Q=()=>{const t=x.useContext(Z);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t},L=({onFileAccepted:t,accept:s=[".csv",".txt",".dat"],label:n="Upload File",description:o="CSV, TXT, or DAT files (drag and drop or click)",className:a=""})=>{const{getRootProps:r,getInputProps:l,isDragActive:i,open:d}=je({accept:s.reduce((m,p)=>({...m,[p]:[]}),{}),multiple:!1,noClick:!0,onDrop:m=>{m.length>0&&t(m[0])}});return e.jsxs(S,{...r({className:"flex flex-col items-center justify-center border-dashed border-2 border-muted-foreground/30 p-6 rounded-lg cursor-pointer transition-colors hover:border-primary/60 bg-background "+(i?"bg-accent/30 border-primary/80 ":"")+a}),tabIndex:0,"aria-label":typeof n=="string"?n:"File Upload",children:[e.jsx("input",{...l()}),e.jsxs("div",{className:"flex flex-col items-center text-muted-foreground mb-2",children:[e.jsx(ye,{size:40,className:"mb-2"}),e.jsx("span",{className:"font-semibold",children:n}),e.jsx("span",{className:"text-xs text-center",children:o})]}),e.jsx(C,{type:"button",onClick:d,className:"mt-2",variant:"outline",children:"Select File"})]})},kt=({onDataLoaded:t})=>{const{showNotification:s}=Q(),[n,o]=R.useState(!1),[a,r]=R.useState(!1),l=x.useCallback((b,c)=>{const h=new FileReader;h.onload=u=>{var y;try{const P=(y=u.target)==null?void 0:y.result,D=_(P);if(!D.length)throw new Error("No valid data found.");t(D,b.name,c),s(`Loaded ${c==="sample"?"sample":"reference"}: ${b.name}`,"success")}catch(P){s(`Failed to parse ${c==="sample"?"file":"reference"}: ${P.message}`,"error")}},h.onerror=()=>s(`Error reading ${c==="sample"?"file":"reference"} file.`,"error"),h.readAsText(b)},[t,s]),i=x.useCallback((b,c)=>{l(b,c),c==="sample"&&o(!1),c==="reference"&&r(!1)},[l]),d=x.useCallback(b=>{const c=b.target.value;try{if(c){const h=_(c);if(!h.length)throw new Error("No valid data found in pasted text.");t(h,"Pasted Data","sample"),s("Loaded pasted data.","success")}}catch(h){s(`Failed to parse pasted data: ${h.message}`,"error")}},[t,s]),[m,p]=R.useState(!1),[g,f]=R.useState(!1);return e.jsxs("div",{className:"w-full max-w-3xl mx-auto mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border p-6 flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ve,{size:22,className:"text-indigo-600 mr-2"}),e.jsx("h2",{className:"font-bold text-lg",children:"Upload Sample Data"})]}),e.jsx(L,{onFileAccepted:b=>i(b,"sample"),label:null,description:"CSV, TXT, or DAT files (drag and drop or click)"}),e.jsx("button",{className:"text-xs mt-4 text-indigo-700 hover:underline self-start",type:"button",onClick:()=>p(b=>!b),children:m?"Hide Paste Data":"Paste Data Instead"}),m&&e.jsx("div",{className:"mt-2",children:e.jsx(I,{rows:4,placeholder:"Paste your XRD data here (angle,intensity format)",onChange:d,className:"w-full"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border p-6 flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ne,{size:22,className:"text-teal-600 mr-2"}),e.jsx("h2",{className:"font-bold text-lg",children:"Upload Reference Pattern"})]}),e.jsx(L,{onFileAccepted:b=>i(b,"reference"),label:null,description:"CSV, TXT, or DAT files (drag and drop or click)"}),e.jsx("button",{className:"text-xs mt-4 text-teal-700 hover:underline self-start",type:"button",onClick:()=>f(b=>!b),children:g?"Hide Paste Data":"Paste Data Instead"}),g&&e.jsx("div",{className:"mt-2",children:e.jsx(I,{rows:4,placeholder:"Paste your XRD reference pattern here (angle,intensity format)",onChange:b=>{const c=b.target.value;try{if(c){const h=_(c);if(!h.length)throw new Error("No valid data found in pasted text.");t(h,"Pasted Reference","reference"),s("Loaded pasted reference.","success")}}catch(h){s(`Failed to parse pasted reference: ${h.message}`,"error")}},className:"w-full"})})]})]})},Ct=({datasets:t,peakMatches:s,params:n})=>{const o=[],a=n.comparison.mode,r=n.comparison.offset;if(t.forEach((i,d)=>{const m=i.color;if(!i.visible)return;const p=O(d,r,a),g=i.data.map(c=>c.angle),f=i.data.map(c=>(c.backgroundSubtracted??c.intensity)+p),b=`dataset-${d}`;o.push({x:g,y:f,type:"scatter",mode:"lines",name:i.name,legendgroup:b,line:{color:m,width:1}}),i.peaks&&i.peaks.length>0&&o.push({x:i.peaks.map(c=>c.angle),y:i.peaks.map(c=>c.intensity+p),mode:"markers",type:"scatter",name:"Peaks",legendgroup:b,marker:{color:m,size:8,symbol:"circle",line:{color:"black",width:0}},hoverinfo:"text",text:i.peaks.map((c,h)=>`Peak ${h+1}: ${c.angle.toFixed(2)}°<br>Intensity: ${c.intensity.toFixed(0)}`)})}),n.rietveld.enabled&&n.rietveld.refinedIntensity){const i=t.find(d=>d.type==="sample"&&d.visible);if(i){const d=i.data.map(c=>c.angle),m=i.data.map(c=>c.backgroundSubtracted??c.intensity),p=n.rietveld.refinedIntensity,g=m.map((c,h)=>c-p[h]),f=-Math.max(...m)*.15,b=g.map(c=>c+f);o.push({x:d,y:p,type:"scatter",mode:"lines",name:"Calculated (Rietveld)",line:{color:"black",width:1.5,dash:"solid"}}),o.push({x:d,y:b,type:"scatter",mode:"lines",name:"Difference (Obs - Calc)",line:{color:"gray",width:1}}),o.push({x:[d[0],d[d.length-1]],y:[f,f],type:"scatter",mode:"lines",name:"Diff Baseline",showlegend:!1,line:{color:"lightgray",width:1,dash:"dash"}})}}s&&s.length>0&&o.push({x:s.map(i=>i.samplePeak.angle),y:s.map(i=>{const d=t.findIndex(p=>p.name===i.sampleDataset),m=O(d,r,a);return i.samplePeak.intensity+m}),mode:"markers",type:"scatter",name:"Matched Peaks",marker:{color:"red",size:8,symbol:"star",line:{color:"black",width:0}},hoverinfo:"text",text:s.map(i=>`Sample: ${i.sampleDataset}<br>Ref: ${i.referenceDataset}<br>Δ: ${i.delta.toFixed(3)}°`)});const l={title:"XRD Pattern Analysis",xaxis:{title:"2θ (degrees)"},yaxis:{title:"Intensity (a.u.)"},legend:{orientation:"h",x:.5,xanchor:"center",y:1.15,yanchor:"bottom",traceorder:"grouped",itemsizing:"constant",itemwidth:30,groupgap:40,tracegroupgap:5},autosize:!0,margin:{t:50,l:50,r:30,b:50},plot_bgcolor:"white",paper_bgcolor:"white",font:{family:"inherit",size:14}};return e.jsx("div",{className:"w-full max-w-full h-[300px] sm:h-[400px] md:h-[500px] overflow-x-auto",children:e.jsx(we,{data:o,layout:l,useResizeHandler:!0,style:{width:"100%",height:"100%"},config:{responsive:!0,displaylogo:!1,toImageButtonOptions:{format:"png",filename:"xrd-pattern",height:500,width:900,scale:2}}})})},St=E?E:({children:t})=>e.jsx(e.Fragment,{children:t}),w=Pe,k=De,v=x.forwardRef(({className:t,sideOffset:s=4,...n},o)=>e.jsx(ke,{children:e.jsx(Ce,{sideOffset:s,children:e.jsx(Se,{ref:o,className:j("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})}));v.displayName="TooltipContent";const Pt=({params:t,onParamsChange:s})=>{const[n,o]=R.useState(!1),a=(r,l,i)=>{s({...t,[r]:{...t[r],[l]:i}})};return e.jsx(St,{children:e.jsx("div",{className:"space-y-6 p-4 bg-white rounded-md shadow-sm max-w-full sm:max-w-lg mx-auto",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Processing Parameters"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center font-medium text-gray-700 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.smoothing.enabled,onChange:r=>a("smoothing","enabled",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2"}),"Smoothing"]}),t.smoothing.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Window Size",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Number of points used for smoothing window."})]})]}),e.jsx("input",{type:"number",value:t.smoothing.windowSize,onChange:r=>a("smoothing","windowSize",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Polynomial Order",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Order of the polynomial used for Savitzky-Golay smoothing."})]})]}),e.jsx("input",{type:"number",value:t.smoothing.polynomialOrder,onChange:r=>a("smoothing","polynomialOrder",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center font-medium text-gray-700 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.background.enabled,onChange:r=>a("background","enabled",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2"}),"Background Subtraction"]}),t.background.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.background.method,onChange:r=>a("background","method",r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"sliding",children:"Sliding Window"}),e.jsx("option",{value:"spline",children:"Spline Fitting"}),e.jsx("option",{value:"rollingBall",children:"Rolling Ball"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Window Size",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Number of points used for smoothing window."})]})]}),e.jsx("input",{type:"number",value:t.background.windowSize,onChange:r=>a("background","windowSize",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),t.background.method==="rollingBall"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Iterations",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Number of times the rolling ball algorithm is applied."})]})]}),e.jsx("input",{type:"number",value:t.background.iterations,onChange:r=>a("background","iterations",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Pattern Comparison"}),e.jsx("div",{className:"mt-2 space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Mode",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Overlay plots or stack them vertically (Waterfall)."})]})]}),e.jsxs("select",{value:t.comparison.mode,onChange:r=>a("comparison","mode",r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"overlay",children:"Overlay"}),e.jsx("option",{value:"waterfall",children:"Waterfall"})]})]}),t.comparison.mode==="waterfall"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Y-Offset",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Vertical distance between stacked patterns."})]})]}),e.jsx("input",{type:"number",value:t.comparison.offset,onChange:r=>a("comparison","offset",parseInt(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Peak Analysis"}),e.jsx("div",{className:"mt-2 flex flex-col gap-2",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:t.peaks.useMinHeight,onChange:r=>a("peaks","useMinHeight",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Height (%)",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Only peaks above this relative height (percent of max intensity) are detected."})]})]})]}),t.peaks.useMinHeight&&e.jsx("input",{type:"number",value:t.peaks.minHeight*100,onChange:r=>a("peaks","minHeight",parseFloat(r.target.value)/100),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:t.peaks.useMinDistance,onChange:r=>a("peaks","useMinDistance",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Distance (°)",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Minimum angular distance between detected peaks."})]})]})]}),t.peaks.useMinDistance&&e.jsx("input",{type:"number",value:t.peaks.minDistance,onChange:r=>a("peaks","minDistance",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center pl-1",children:[e.jsx("input",{type:"checkbox",checked:t.peaks.useMinProminence,onChange:r=>a("peaks","useMinProminence",r.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 flex items-center gap-1",children:["Use Min. Prominence",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Only peaks with a prominence above this value are detected."})]})]})]}),t.peaks.useMinProminence&&e.jsx("input",{type:"number",value:t.peaks.minProminence,onChange:r=>a("peaks","minProminence",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between items-center px-4 py-2 bg-gray-100 rounded text-gray-700 font-medium border border-gray-200 hover:bg-gray-200 transition",onClick:()=>o(r=>!r),"aria-expanded":n,children:["Advanced Settings",e.jsx("span",{className:"ml-2",children:n?"▲":"▼"})]}),n&&e.jsxs("div",{className:"mt-4 space-y-4 bg-gray-50 rounded p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Instrument Broadening (°)",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"Instrumental peak broadening value in degrees 2θ."})]})]}),e.jsx("input",{type:"number",value:t.peaks.instrumentBroadening,onChange:r=>a("peaks","instrumentBroadening",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 flex items-center gap-1",children:["Wavelength (Å)",e.jsxs(w,{children:[e.jsx(k,{asChild:!0,children:e.jsx("span",{tabIndex:0,className:"ml-1 cursor-pointer text-gray-400 hover:text-gray-600",children:e.jsx(N,{size:16})})}),e.jsx(v,{children:"X-ray wavelength used for conversion and analysis."})]})]}),e.jsx("input",{type:"number",value:t.peaks.wavelength,onChange:r=>a("peaks","wavelength",parseFloat(r.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})]})]})]})})})},Dt=t=>{const s={a:0,b:0,c:0,alpha:90,beta:90,gamma:90,atoms:[]},n=t.split(/\r?\n/);let o=[],a=!1;const r=l=>{const i=l.replace(/\(.*?\)/,"");return parseFloat(i)};for(let l=0;l<n.length;l++){const i=n[l].trim();if(!(!i||i.startsWith("#"))){if(i.startsWith("loop_")){a=!0,o=[];continue}if(a)if(i.startsWith("_"))o.push(i);else{const d=i.split(/\s+/);if(d.length>=o.length){const m={};o.forEach((p,g)=>{const f=d[g];p==="_atom_site_label"&&(m.label=f),p==="_atom_site_type_symbol"&&(m.symbol=f),p==="_atom_site_fract_x"&&(m.x=r(f)),p==="_atom_site_fract_y"&&(m.y=r(f)),p==="_atom_site_fract_z"&&(m.z=r(f)),p==="_atom_site_occupancy"&&(m.occupancy=r(f))}),m.label&&s.atoms.push(m)}}else i.startsWith("_cell_length_a")&&(s.a=r(i.split(/\s+/)[1])),i.startsWith("_cell_length_b")&&(s.b=r(i.split(/\s+/)[1])),i.startsWith("_cell_length_c")&&(s.c=r(i.split(/\s+/)[1])),i.startsWith("_cell_angle_alpha")&&(s.alpha=r(i.split(/\s+/)[1])),i.startsWith("_cell_angle_beta")&&(s.beta=r(i.split(/\s+/)[1])),i.startsWith("_cell_angle_gamma")&&(s.gamma=r(i.split(/\s+/)[1])),i.startsWith("_symmetry_space_group_name_H-M")&&(s.spaceGroup=i.replace("_symmetry_space_group_name_H-M","").trim().replace(/'/g,""))}}return s},Rt=({params:t,onParamsChange:s,onRunRefinement:n})=>{const o=async a=>{var l;const r=(l=a.target.files)==null?void 0:l[0];if(r){const i=await r.text(),d=Dt(i);s({...t,rietveld:{...t.rietveld,cifContent:i,structure:d}})}};return e.jsxs(S,{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Rietveld Refinement"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Upload CIF File"}),e.jsx("input",{type:"file",accept:".cif",onChange:o,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90"})]}),t.rietveld.structure&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Lattice: a=",t.rietveld.structure.a.toFixed(3),", b=",t.rietveld.structure.b.toFixed(3),", c=",t.rietveld.structure.c.toFixed(3)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{id:"refine-enabled",checked:t.rietveld.enabled,onCheckedChange:a=>s({...t,rietveld:{...t.rietveld,enabled:!!a}})}),e.jsx("label",{htmlFor:"refine-enabled",className:"text-sm",children:"Enable Overlay"})]}),e.jsx(C,{className:"w-full",onClick:n,disabled:!t.rietveld.cifContent,children:"Run Refinement"}),t.rietveld.rwp!==void 0&&e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Goodness of Fit (Rwp): ",(t.rietveld.rwp*100).toFixed(2),"%"]})]})]})},zt=U("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ee=x.forwardRef(({className:t,variant:s,...n},o)=>e.jsx("div",{ref:o,role:"alert",className:j(zt({variant:s}),t),...n}));ee.displayName="Alert";const Mt=x.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:j("mb-1 font-medium leading-none tracking-tight",t),...s}));Mt.displayName="AlertTitle";const _t=x.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:j("text-sm [&_p]:leading-relaxed",t),...s}));_t.displayName="AlertDescription";const Ft={success:void 0,info:void 0,error:"destructive"},It=()=>{const{notification:t,clearNotification:s}=Q();return t?e.jsx("div",{className:"fixed top-4 left-1/2 z-50 -translate-x-1/2 w-full max-w-md px-2",children:e.jsx(ee,{variant:Ft[t.type],className:"shadow-lg cursor-pointer",onClick:s,children:t.message})}):null},Tt=()=>e.jsx("div",{className:"bg-background min-h-screen",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto my-8 p-4 md:p-8",children:[e.jsxs(S,{className:"p-6 mb-8 shadow-md bg-card",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-primary",children:"About XRD Analyzer"}),e.jsxs("p",{className:"text-lg mb-6",children:[e.jsx("span",{className:"font-semibold",children:"XRD Analyzer"})," is a web-based tool for visualizing and analyzing X-ray diffraction (XRD) data. It supports common file formats (CSV, TXT, DAT) and provides interactive plotting, data processing, and peak analysis features."]})]}),e.jsxs(S,{className:"p-6 mb-8 shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center text-primary",children:[e.jsx(Re,{className:"mr-2 h-6 w-6"}),"User Guide"]}),e.jsxs("ol",{className:"list-decimal pl-6 space-y-4",children:[e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(ze,{className:"mr-2 h-5 w-5 text-primary"}),"Upload Data"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Use the file upload section to import your XRD data files. Supported formats: CSV, TXT, DAT."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Me,{className:"mr-2 h-5 w-5 text-primary"}),"Plot Visualization"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Uploaded data will be plotted interactively. Zoom, pan, and hover for details."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Processing Tools"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Apply background subtraction, smoothing, normalization, and baseline correction using the controls provided."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(_e,{className:"mr-2 h-5 w-5 text-primary"}),"Peak Detection"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Detect peaks with adjustable sensitivity. Peaks will be marked on the plot."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Phase Identification"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"(Optional) Upload a reference pattern for phase identification or use the built-in simple matcher."})]}),e.jsxs("li",{className:"p-4 bg-muted rounded-md shadow-sm",children:[e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-5 w-5 text-primary"}),"Export"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Download processed data as CSV or the plot as PNG."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs(S,{className:"p-6 shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-primary",children:"Features"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{className:"text-muted-foreground",children:"Interactive XRD plotting (Plotly.js)"}),e.jsx("li",{className:"text-muted-foreground",children:"Data processing: background subtraction, smoothing, normalization, baseline correction"}),e.jsx("li",{className:"text-muted-foreground",children:"Peak detection with adjustable sensitivity"}),e.jsx("li",{className:"text-muted-foreground",children:"Phase identification (simple or user-uploaded reference)"}),e.jsx("li",{className:"text-muted-foreground",children:"Export options: CSV, PNG"}),e.jsx("li",{className:"text-muted-foreground",children:"Responsive, user-friendly interface"})]})]}),e.jsxs(S,{className:"p-6 shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center text-primary",children:[e.jsx(Ie,{className:"mr-2 h-6 w-6"}),"Contact & Feedback"]}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"For questions, feedback, or bug reports, please visit the GitHub repository or contact me via email."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("a",{href:"https://github.com/jovenpaoloangeles/xrd-analyzer/",className:"inline-block px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",target:"_blank",rel:"noopener noreferrer",children:"GitHub Repository"}),e.jsx("a",{href:"mailto:jovenpaoloangeles@gmail.com",className:"inline-block px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors",children:"jovenpaoloangeles@gmail.com"})]})]})]})]})});function At(t,s,n=.2){const o=[];return t.forEach(a=>{s.forEach(r=>{a.peaks.forEach(l=>{const i=r.peaks.reduce((d,m)=>{const p=Math.abs(l.angle-m.angle);return p<d.delta?{peak:m,delta:p}:d},{peak:null,delta:1/0});i.peak&&i.delta<=n&&o.push({samplePeak:l,referencePeak:i.peak,sampleDataset:a.name,referenceDataset:r.name,delta:i.delta})})})}),o}const Et={smoothing:{enabled:!1,windowSize:5,polynomialOrder:2},background:{enabled:!1,method:"sliding",windowSize:20,iterations:3},peaks:{minHeight:.1,minDistance:.5,minProminence:10,instrumentBroadening:.1,wavelength:1.5406,useMinHeight:!1,useMinDistance:!1,useMinProminence:!1},comparison:{mode:"overlay",offset:50},rietveld:{enabled:!1}},H=["#4477AA","#EE6677","#228833","#CCBB44","#66CCEE","#AA3377","#BBBBBB"],$t=t=>H[t%H.length];function Bt(){const[t,s]=x.useState([]),[n,o]=x.useState(!1),[a,r]=x.useState(Et),[l,i]=x.useState([]),[d,m]=x.useState(!1),p=x.useCallback(c=>{let h=c.map(u=>({...u}));return h=pt(h,a),h=gt(h,a),h},[a]),g=x.useCallback((c,h,u)=>{const y=p(c),P=F(y,a);s(D=>[...D,{id:`${u}-${Date.now()}`,name:h,type:u,color:$t(D.length),data:y,peaks:P,visible:!0}]),u==="sample"&&o(!0)},[p,a]),f=x.useCallback(c=>{r(c),m(!0),s(h=>h.map(u=>{const y=p(u.data),P=F(y,c);return{...u,data:y,peaks:P}})),setTimeout(()=>m(!1),300)},[p]),b=x.useCallback(()=>{const c=t.find(u=>u.type==="sample"&&u.visible);if(!c||!a.rietveld.structure)return;m(!0);const h=new Worker(new URL("/xrd-analyzer/assets/refinement.worker-Dr0mFDyY.js",import.meta.url),{type:"module"});h.postMessage({experimentalData:c.data,structure:a.rietveld.structure,wavelength:a.peaks.wavelength,paramsToRefine:["a","scale"]}),h.onmessage=u=>{const{calculatedIntensity:y,refinedStructure:P,rwp:D}=u.data;r(A=>({...A,rietveld:{...A.rietveld,refinedIntensity:y,rwp:D,structure:P,enabled:!0}})),m(!1),h.terminate()},h.onerror=u=>{console.error("Worker error",u),m(!1),h.terminate()}},[t,a]);return R.useEffect(()=>{m(!0),s(c=>c.map(h=>{const u=p(h.data),y=F(u,a);return{...h,data:u,peaks:y}})),setTimeout(()=>m(!1),300)},[a]),e.jsxs(wt,{children:[e.jsx(It,{}),e.jsx(Te,{children:e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx(ot,{}),e.jsxs(Ae,{children:[e.jsx($,{path:"/",element:e.jsx("div",{className:"max-w-[1400px] mx-auto my-8 p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold mr-4",children:"Data Input"}),e.jsx("button",{className:"ml-auto px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm",onClick:()=>o(c=>!c),children:n?"Show Data Input":"Hide Data Input"})]}),!n&&e.jsx(S,{className:"mb-6 p-4",children:e.jsx(kt,{onDataLoaded:g,hasSample:t.some(c=>c.type==="sample"),hasReference:t.some(c=>c.type==="reference"),onAddSample:()=>o(!1),onAddReference:()=>o(!1)})}),t.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Loaded Patterns"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:t.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-4 h-4 rounded-full mr-2",style:{background:c.color}}),e.jsx("span",{className:"font-medium text-sm",children:c.name})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[e.jsx(T,{checked:c.visible,onCheckedChange:()=>s(h=>h.map(u=>u.id===c.id?{...u,visible:!u.visible}:u))}),e.jsx("span",{className:"text-xs",children:"Show"})]})]},c.id))})]}),(()=>{const c=t.filter(u=>u.visible&&u.type==="sample"),h=t.filter(u=>u.visible&&u.type==="reference");return R.useEffect(()=>{i(At(c,h))},[t]),t.filter(u=>u.visible).length>0?e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"XRD Pattern"}),e.jsxs("div",{className:"md:col-span-2 col-span-1 relative",children:[e.jsx(Ct,{datasets:t.filter(u=>u.visible),peakMatches:l,params:a}),d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 z-20",children:e.jsx(Ee,{className:"animate-spin w-16 h-16 text-primary"})})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{className:"px-4 py-2 rounded bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow",onClick:()=>Le(()=>import("./exportCSV-Sq8kO-19.js"),[]).then(u=>u.exportDatasetsToCSV(t.filter(y=>y.visible))),children:"Export CSV"})}),l.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Phase Match Summary"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border bg-background",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 border",children:"Sample"}),e.jsx("th",{className:"px-2 py-1 border",children:"Reference"}),e.jsx("th",{className:"px-2 py-1 border",children:"Sample Peak (°2θ)"}),e.jsx("th",{className:"px-2 py-1 border",children:"Reference Peak (°2θ)"}),e.jsx("th",{className:"px-2 py-1 border",children:"Δ (°2θ)"})]})}),e.jsx("tbody",{children:l.map((u,y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:u.sampleDataset}),e.jsx("td",{className:"px-2 py-1 border",children:u.referenceDataset}),e.jsx("td",{className:"px-2 py-1 border",children:u.samplePeak.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1 border",children:u.referencePeak.angle.toFixed(2)}),e.jsx("td",{className:"px-2 py-1 border",children:u.delta.toFixed(3)})]},y))})]})})]})]}):null})(),t.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Analysis Results"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:t.map(c=>e.jsx(at,{dataset:c},c.id))})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Processing Controls"}),e.jsx(S,{className:"p-4 mb-4",children:e.jsx(Pt,{params:a,onParamsChange:f})}),e.jsx(Rt,{params:a,onParamsChange:f,onRunRefinement:b})]})]})})}),e.jsx($,{path:"/about",element:e.jsx(Tt,{})})]})]})})]})}$e(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(Bt,{})}));
